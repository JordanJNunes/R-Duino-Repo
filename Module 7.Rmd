---
title: "Module 7"
author: "Chris, Joe, Karim"
date: "11/27/2022"
output: html_document
bibliography: BIOL3140_RDuino_mod7.bib
---

### Introduction

In this project we will be exploring the effect of length on muscle force generation and how fatigue impacts this force-length (FL) relationship. The question of how fatigue influences the FL relationship has been asked for a while in animal models. Many past studies have hope to analyze the impact of fatigue on the FL relationship in rats, with many finding that fatigue cause a sizable shift towards longer muscle length at which the maximal force occurs. Other studies, like that of @macnaughton2006reports in 2006, found that this right-wards shift towards longer length at maximum force generation is overexaggerated, leading to some contention about the exact increase size of the shift. As a result of this uncertainty in the field, our study hopes to show another example of how the FL relationship is influence by fatigue in an attempt to provide more certainty around how sizable the shift actually is. In addition, our study hopes to provide more context on how fatigue impacts the FL relationship of the human upper limb specifically in humans, as the literature does not appear to have much information in this area. This study will prove to be important as we seek to gain a better understanding of our muscles and how fatigue impacts the amount of actin-myosin overlap, and thereby the isometric force created, at each point in our contraction.
	In order to assess the force length relationship of the upper human limb in our study, we will be making the assumption that the force we measure at our hand as the muscle produces isometric force at various lengths is a reasonable reflection of the FL relationship government force at the fiber level, based on previous work by @rassier1999length. Additionally, because the human upper limb is essentially a 3rd order lever (muscles on either side of the arm span the elbow joint), we will be using the mechanical advantage equation to predict the amount of output force created by the human upper limb based on the output force present on the human palm at the point of exertion. Our investigation will be broken up into three parts. First, we will produce the isometric force-angle curves for the human forearm flexors undertaking the maximum voluntary contractions (MVCs). Second, we will compare the angle at which the maximum isometric force occurs between non-fatigues and eccentrically fatigues forearm flexors. Third, we will investigate the underlying mechanisms resulting in a shift of the angle at which maximum isometric force occurs after eccentric fatigue.



### Methods



### Results

```{r,include=FALSE}
library(tidyverse)
library(MuMIn)
library(geiger)
library(knitr)
```

```{css, echo=FALSE}
h1, h4 {
  text-align: center;
  color: green;
  font-weight: bold;
}
```

<center>
```{r,include=FALSE}
#loading data
f<- list.files("Project 8 data",full.names = T)
f.l <- list()
angs<- seq(45,168.75,length.out = 12)
for(i in f){
  f.i<-read_delim(i,delim = " ",show_col_types = FALSE, col_names = c("Reading","Force","Unit"))
  m <- unlist(strsplit(i,"_"))
  subject<-m[2]
  angle<-(angs[which.min(abs(angs-as.numeric(m[3])))])
  experiment<-gsub("\\..+","",m[4])
  f.l[[i]]<-f.i%>%
    mutate(subject=subject,angle=angle,experiment=experiment,)
}
dat<-do.call(rbind,f.l)
```
```{r,include=FALSE}
#finding max of each recording
dat_recording_max<-dat%>%
  group_by(subject,angle,experiment)%>%
  summarize(recording_max=max(abs(Force)))%>%
  print()
#finding max of each experiment
dat_Fmax<-dat_recording_max%>%
  group_by(subject,experiment)%>%
  summarize(Fmax=max(recording_max))%>%
  print()
#normalizing the max values
dat_Fmax_norm<-dat_recording_max%>%
    left_join(dat_Fmax)
dat_Fmax_norm<-dat_Fmax_norm%>%
  group_by(angle,subject,experiment)%>%
  summarize(Fmax_norm=(recording_max/Fmax))%>%
  print()
```
```{r,fig.cap="Figure 1. Normalized Fmax Values vs. Angle", echo=FALSE}
#plot of normalized maxes by experiment
dat_Fmax_norm%>%
  ggplot(aes(x=angle,y=Fmax_norm,col=experiment))+geom_point()
```
```{r,include=FALSE}
dat_Fmax_norm_mean<-dat_Fmax_norm%>%
  group_by(angle,experiment)%>%
  summarize(Fmax_norm_mean=mean(Fmax_norm))
```
```{r,fig.cap="Figure 2. Mean Normalized Fmax vs. Angle", echo=FALSE}
#plot of means of normalized Fmax for each angle and experiment
dat_Fmax_norm_mean%>%
  ggplot(aes(x=angle,y=Fmax_norm_mean,col=experiment))+geom_point()+labs(y="Mean Normalized Fmax", x="Angle")
```
```{r,include=FALSE}
#time to model
poly.m2 <- lm(Fmax_norm~poly(angle,2),data=dat_Fmax_norm) #second order
poly.m3 <- lm(Fmax_norm~poly(angle,3),data=dat_Fmax_norm) #third order
poly.m4 <- lm(Fmax_norm~poly(angle,4),data=dat_Fmax_norm) #fourth order

#finding which order fits the best
poly.aic<-AICc(poly.m2,poly.m3,poly.m4) 
print(poly.aic) #2nd order, poly.m2, has the best fit
AICs <- dat_Fmax_norm%>%
  group_by(subject,experiment)%>%
  summarize(
    m2=AICc(lm(Fmax_norm~poly(angle,2))), #second order
    m3=AICc(lm(Fmax_norm~poly(angle,3))), #third order
    m4=AICc(lm(Fmax_norm~poly(angle,4))) #fourth order
  )%>%
  pivot_longer(m2:m4,names_to="model",values_to="AICc")%>%
  print()
```
```{r,include=FALSE}
#predicting values based on best fitting model for 1000 angles
x.pred<-seq(45,157.5,length.out=1000)
fits <- dat_Fmax_norm%>%
  group_by(subject,experiment)%>%
  summarize(
    m2=predict(lm(Fmax_norm~poly(angle,2)),newdata=data.frame(angle=x.pred)), #second order
    m3=predict(lm(Fmax_norm~poly(angle,3)),newdata=data.frame(angle=x.pred)), #third order
    m4=predict(lm(Fmax_norm~poly(angle,4)),newdata=data.frame(angle=x.pred)) #fourth order
  )%>%
  pivot_longer(m2:m4,names_to="model")%>%
  group_by(subject,experiment,model)%>%
  summarize(theta_max=x.pred[which.max(value)])%>%
  print()
#combining AICs and fits
best.models<-fits%>%
  left_join(AICs)%>%
  group_by(subject,experiment)%>%
  mutate(best=AICc==min(AICc))%>%
  filter(best==TRUE)%>%
  select(-best)%>%
  print()
```
```{r,include=FALSE}
#Determining significance in the difference between control and fatigue theta_max? 
anova_thetamax<-anova(lm(theta_max~experiment,best.models))
```
```{r, echo=FALSE}
kable(anova_thetamax,caption="Table 1. Anova for Theta Max")
```
```{r,include=FALSE}
#Mean and SEM values for shift in theta_max
theta_max<-best.models%>%
  pivot_wider(id_cols=subject,names_from = experiment,values_from=theta_max)%>%
  mutate(shift=fatigue-control)%>%
  ungroup()%>%
  summarize(mean.shift=mean(shift,na.rm=TRUE),se.shift=sd(shift,na.rm=TRUE)/sqrt(length(shift)))
```
```{r, echo=FALSE}
kable(theta_max,caption="Table 2. Mean and SEM Values for Theta Max ")
```


### Discussion



### Author Contributions





